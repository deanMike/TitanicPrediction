{
    "contents" : "setwd(\"C:/Users/Mike/Google Drive/School/2014 - 2015/Fall/Prediction/Final Project/R\")\n\ntrain <- read.csv(\"data/train.csv\")\ntest <- read.csv(\"data/test.csv\")\n\n# Install and load required packages for decision trees and forests\ninstall.packages('rpart')\nlibrary(rpart)\ninstall.packages('randomForest')\nlibrary(randomForest)\ninstall.packages('party')\nlibrary(party)\n##Libraries for better looking plots.\ninstall.packages('rattle')\ninstall.packages('rpart.plot')\ninstall.packages('RColorBrewer')\nlibrary(rattle)\nlibrary(rpart.plot)\nlibrary(RColorBrewer)\n\n# Join together the test and train sets for easier feature engineering\ntest$Survived <- NA\ncombi <- rbind(train, test)\n\n# Convert to a string\ncombi$Name <- as.character(combi$Name)\n\n# Engineered variable: Title\ncombi$Title <- sapply(combi$Name, FUN=function(x) {strsplit(x, split='[,.]')[[1]][2]})\ncombi$Title <- sub(' ', '', combi$Title)\n# Combine small title groups\ncombi$Title[combi$Title %in% c('Mme', 'Mlle')] <- 'Mlle'\ncombi$Title[combi$Title %in% c('Capt', 'Don', 'Major', 'Sir')] <- 'Sir'\ncombi$Title[combi$Title %in% c('Dona', 'Lady', 'the Countess', 'Jonkheer')] <- 'Lady'\n# Convert to a factor\ncombi$Title <- factor(combi$Title)\n\n# Engineered variable: Family size\ncombi$FamilySize <- combi$SibSp + combi$Parch + 1\n\n# Engineered variable: Family\ncombi$Surname <- sapply(combi$Name, FUN=function(x) {strsplit(x, split='[,.]')[[1]][1]})\ncombi$FamilyID <- paste(as.character(combi$FamilySize), combi$Surname, sep=\"\")\ncombi$FamilyID[combi$FamilySize <= 2] <- 'Small'\n# Delete erroneous family IDs\nfamIDs <- data.frame(table(combi$FamilyID))\nfamIDs <- famIDs[famIDs$Freq <= 2,]\ncombi$FamilyID[combi$FamilyID %in% famIDs$Var1] <- 'Small'\n# Convert to a factor\ncombi$FamilyID <- factor(combi$FamilyID)\n\n# Fill in Age NAs\nsummary(combi$Age)\nAgefit <- rpart(Age ~ Pclass + Sex + SibSp + Parch + Fare + Embarked + Title + FamilySize, \n                data=combi[!is.na(combi$Age),], method=\"anova\")\ncombi$Age[is.na(combi$Age)] <- predict(Agefit, combi[is.na(combi$Age),])\n# Check what else might be missing\nsummary(combi)\n# Fill in Embarked blanks\nsummary(combi$Embarked)\nwhich(combi$Embarked == '')\ncombi$Embarked[c(62,830)] = \"S\"\ncombi$Embarked <- factor(combi$Embarked)\n# Fill in Fare NAs\nsummary(combi$Fare)\nwhich(is.na(combi$Fare))\ncombi$Fare[1044] <- median(combi$Fare, na.rm=TRUE)\n\n# New factor for Random Forests, only allowed <32 levels, so reduce number\ncombi$FamilyID2 <- combi$FamilyID\n# Convert back to string\ncombi$FamilyID2 <- as.character(combi$FamilyID2)\ncombi$FamilyID2[combi$FamilySize <= 3] <- 'Small'\n# And convert back to factor\ncombi$FamilyID2 <- factor(combi$FamilyID2)\n\n# Split back into test and train sets\ntrain <- combi[1:891,]\ntest <- combi[892:1309,]\n\n# Build Random Forest Ensemble\nset.seed(415)\nfit <- randomForest(as.factor(Survived) ~ Pclass + Sex + Age + SibSp + Parch + Fare + Embarked + Title + FamilySize + FamilyID2,\n                    data=train, importance=TRUE, ntree=3000)\n# Look at variable importance\nvarImpPlot(fit)\n# Now let's make a prediction and write a submission file\nPrediction <- predict(fit, test)\nsubmit <- data.frame(PassengerId = test$PassengerId, Survived = Prediction)\nwrite.csv(submit, file = \"output/firstTree.csv\", row.names = FALSE)\n\n# Build condition inference tree Random Forest\nset.seed(415)\nfit <- cforest(as.factor(Survived) ~ Pclass + Sex + Age + SibSp + Parch + Fare + Embarked + Title + FamilySize + FamilyID, data = train, controls=cforest_unbiased(ntree=3000, mtry=3)) \nfancyRpartPlot(fit)\n# Writing the prediction \nPrediction <- predict(fit, test, OOB=TRUE, type = \"response\")\nsubmit <- data.frame(PassengerId = test$PassengerId, Survived = Prediction)\nwrite.csv(submit, file = \"output/forest.csv\", row.names = FALSE)\n",
    "created" : 1418268817859.000,
    "dirty" : true,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "197339962",
    "id" : "7EEA33E0",
    "lastKnownWriteTime" : 1418268939,
    "path" : "C:/Users/Mike/Google Drive/School/2014 - 2015/Fall/Prediction/Final Project/R/CombineAllTheScripts.R",
    "project_path" : "CombineAllTheScripts.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "source_on_save" : false,
    "type" : "r_source"
}